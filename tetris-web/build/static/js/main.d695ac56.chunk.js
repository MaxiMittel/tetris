(this["webpackJsonptetris-web"]=this["webpackJsonptetris-web"]||[]).push([[0],{287:function(e,t,n){"use strict";n.r(t);var a,c,r,s=n(1),o=n.n(s),i=n(112),l=n.n(i),u=(n(69),n(2)),d=n(0),b=function(e){var t=function(){e.authenticated?window.location.href="/account":window.location.href="/signin"};return Object(d.jsx)("div",{children:Object(d.jsxs)("div",{className:"page-wrapper with-navbar",children:[Object(d.jsxs)("nav",{className:"navbar",children:[Object(d.jsx)("a",{href:"/",className:"navbar-brand",children:Object(d.jsx)("img",{src:"data:image/png;base64,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",alt:"logo"})}),Object(d.jsxs)("ul",{className:"navbar-nav d-none d-md-flex",children:[Object(d.jsx)("li",{className:"nav-item active",children:Object(d.jsx)("a",{href:"/",className:"nav-link",children:"Play"})}),Object(d.jsx)("li",{className:"nav-item",children:Object(d.jsx)("a",{href:"/search",className:"nav-link",children:"Search"})})]}),Object(d.jsx)("div",{className:"form-inline d-none d-md-flex ml-auto",children:Object(d.jsx)("button",{className:"btn btn-primary",type:"submit",onClick:t,children:e.buttonText})}),Object(d.jsx)("div",{className:"navbar-content d-md-none ml-auto",children:Object(d.jsxs)("div",{className:"dropdown with-arrow",children:[Object(d.jsxs)("button",{className:"btn","data-toggle":"dropdown",type:"button",id:"navbar-dropdown-toggle-btn-1",children:["Menu",Object(d.jsx)("i",{className:"fa fa-angle-down","aria-hidden":"true"})]}),Object(d.jsxs)("div",{className:"dropdown-menu dropdown-menu-right w-200","aria-labelledby":"navbar-dropdown-toggle-btn-1",children:[Object(d.jsx)("a",{href:"/",className:"dropdown-item",children:"Play"}),Object(d.jsx)("a",{href:"/search",className:"dropdown-item",children:"Search"}),Object(d.jsx)("div",{className:"dropdown-divider"}),Object(d.jsx)("div",{className:"dropdown-content",children:Object(d.jsx)("button",{className:"btn btn-primary btn-block",type:"submit",onClick:t,children:e.buttonText})})]})]})})]}),Object(d.jsx)("div",{className:"content-wrapper",children:e.children})]})})},j=(n(124),n(19)),h=n.n(j),f=n(27),m=n(5),O=n.n(m),p="http://18.192.65.75:7777/",x="",g=function(){return new Promise((function(e,t){""!==x?e(x):O.a.get("".concat(p,"/directory-service/getlb")).then((function(t){var n=t.data.server.map((function(e){return"http://".concat(e.ip,":").concat(e.port)}));x=n[Math.floor(Math.random()*n.length)],e(x)})).catch((function(e){console.log(e),t()}))}))},v=function(){return new Promise((function(e,t){O.a.get("".concat(p,"/directory-service/getgs")).then((function(t){var n=t.data.server.map((function(e){return{ip:e.ip,port:e.port}}));e(n)})).catch((function(e){console.log(e),t()}))}))},y=function(e,t){return g().then((function(n){return O.a.post("".concat(n,"/api/account/signup"),{username:e,password:t})}))},A=function(e,t){return g().then((function(n){return O.a.post("".concat(n,"/api/account/signin"),{username:e,password:t})}))},N=function(e){var t=o.a.useState(""),n=Object(u.a)(t,2),a=n[0],c=n[1],r=o.a.useState(""),s=Object(u.a)(r,2),i=s[0],l=s[1],b=o.a.useState(!0),j=Object(u.a)(b,2),m=j[0],O=j[1],p=function(){var t=Object(f.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),A(a,i).then((function(t){console.log(t.data),O(!0),localStorage.setItem("auth",t.data.auth),localStorage.setItem("username",t.data.username),localStorage.setItem("userId",t.data.id),e.onAuthenticated(),window.location.href="/"})).catch((function(e){O(!1),console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:"w-400 card",children:[Object(d.jsx)("h2",{className:"card-title",children:"Sign In"}),Object(d.jsxs)("form",{onSubmit:p,className:"w-400 mw-full",children:[Object(d.jsxs)("div",{className:"form-group",children:[Object(d.jsx)("label",{htmlFor:"username",className:"required",children:"Username"}),Object(d.jsx)("input",{type:"text",className:"form-control",id:"username",placeholder:"Username",required:!0,value:a,onChange:function(e){return c(e.target.value)}})]}),Object(d.jsxs)("div",{className:"form-group "+(m?"":"is-invalid"),children:[Object(d.jsx)("label",{htmlFor:"password",className:"required",children:"Password"}),Object(d.jsx)("input",{type:"password",className:"form-control",id:"password",placeholder:"Password",required:!0,value:i,onChange:function(e){return l(e.target.value)}}),!m&&Object(d.jsx)("div",{className:"invalid-feedback",children:"The username or password is incorrect."})]}),Object(d.jsx)("div",{className:"form-group",children:Object(d.jsx)("input",{className:"btn btn-primary btn-block",type:"submit",value:"Sign in"})}),Object(d.jsxs)("span",{className:"space-top",children:["Don't have an account? ",Object(d.jsx)("a",{href:"/signup",children:"Sign up"})]})]})]})},w=n(118),S=n(4),E=n(3),k=function(e){return Promise.all(e.map((function(e){return function(e){return new Promise((function(t,n){var a=Date.now();O.a.get("http://".concat(e.ip,":").concat(e.port,"/ping")).then((function(){t(Object(E.a)(Object(E.a)({},e),{},{ping:Math.floor((Date.now()-a)/10)}))})).catch((function(){return t(Object(E.a)(Object(E.a)({},e),{},{ping:void 0}))}))}))}(e)})))},C=function(e,t){return k(e).then((function(e){console.log("SERVERS",e);var n=e.sort((function(e,t){return e.ping-t.ping})).filter((function(e){return e.ping&&e.ping<100}));return console.log("PRE",n),t&&(n=n.filter((function(e){return e.port!==t.port}))),console.log("ACCEPTABLE:",n),n[Math.floor(Math.random()*n.length)]}))},P=function(){return g().then((function(e){return O.a.get("".concat(e,"/api/sessions/list"))}))},R=function(e,t,n){return g().then((function(a){return O.a.post("".concat(a,"/api/sessions/delete"),{id:e,ip:t,port:n})}))},U=function(e){var t=o.a.useState(""),n=Object(u.a)(t,2),a=n[0],c=n[1],r=o.a.useState([]),i=Object(u.a)(r,2),l=i[0],b=i[1];Object(s.useEffect)((function(){P().then((function(e){console.log(e.data.sessions),b(e.data.sessions)}))}),[]),Object(s.useEffect)((function(){var e=setInterval((function(){P().then((function(e){b(e.data.sessions)}))}),1e3);return function(){clearInterval(e)}}),[]);return Object(d.jsx)("div",{className:"container-fluid",children:Object(d.jsxs)("div",{className:"row",children:[Object(d.jsxs)("div",{className:"w-400 card",children:[Object(d.jsx)("div",{className:"card-top",children:Object(d.jsx)("h2",{className:"card-title",children:"Join"})}),Object(d.jsx)("div",{className:"lobby-scroll",children:l.map((function(e,t){return Object(d.jsx)(D,{players:e.players,lobbyName:e.name,code:e.id},"lobby_item_"+t)}))})]}),Object(d.jsx)("div",{children:Object(d.jsxs)("div",{className:"w-400 card",children:[Object(d.jsx)("h2",{className:"card-title",children:"Create"}),Object(d.jsxs)("form",{onSubmit:function(e){var t;e.preventDefault(),(t=a,new Promise((function(e,n){g().then((function(a){v().then((function(c){C(c).then((function(c){O.a.post("".concat(a,"/api/sessions/allocate"),{name:t,server:c}).then((function(t){return e(t)})).catch((function(e){return n(e)}))})).catch((function(e){return n(e)}))})).catch((function(e){return n(e)}))}))}))).then((function(e){window.location.href="/lobby/".concat(e.data.id)})).catch((function(e){return console.log(e)}))},className:"mw-full",children:[Object(d.jsxs)("div",{className:"form-group",children:[Object(d.jsx)("label",{htmlFor:"lobbyName",className:"required",children:"Lobby name"}),Object(d.jsx)("input",{type:"text",className:"form-control",id:"lobbyName",placeholder:"e.g. Cool lobby",required:!0,value:a,onChange:function(e){return c(e.target.value)}})]}),Object(d.jsx)("div",{className:"form-group",children:Object(d.jsx)("input",{className:"btn btn-primary btn-block",type:"submit",value:"Create new"})})]})]})})]})})},D=function(e){return Object(d.jsxs)("div",{className:"lobby-item",children:[Object(d.jsx)("div",{className:"lobby-item-text",children:Object(d.jsx)("h2",{className:"lobby-item-heading",children:e.lobbyName})}),Object(d.jsx)("a",{href:"/lobby/".concat(e.code),children:Object(d.jsx)("button",{className:"btn btn-primary",children:"Join"})})]})},B=function(e){var t=o.a.useState(""),n=Object(u.a)(t,2),a=n[0],c=n[1],r=o.a.useState(""),i=Object(u.a)(r,2),l=i[0],b=i[1],j=o.a.useState(""),m=Object(u.a)(j,2),O=m[0],p=m[1],x=o.a.useState(!0),g=Object(u.a)(x,2),v=g[0],A=g[1],N=o.a.useState(!0),w=Object(u.a)(N,2),S=w[0],E=w[1],k=o.a.useState(!0),C=Object(u.a)(k,2),P=C[0],R=C[1];Object(s.useEffect)((function(){A(M(l)||0===l.length)}),[l]),Object(s.useEffect)((function(){E(l===O||0===O.length)}),[l,O]);var U=function(){var t=Object(f.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),v&&S&&l.length>=8&&a.length>0&&y(a,l).then((function(t){localStorage.setItem("auth",t.data.auth),localStorage.setItem("username",t.data.username),localStorage.setItem("userId",t.data.id),e.onAuthenticated(),window.location.href="/"})).catch((function(e){R(!1),console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:"w-400 card",children:[Object(d.jsx)("h2",{className:"card-title",children:"Sign Up"}),Object(d.jsxs)("form",{onSubmit:U,className:"w-400 mw-full",children:[Object(d.jsxs)("div",{className:"form-group "+(P?"":"is-invalid"),children:[Object(d.jsx)("label",{htmlFor:"username",className:"required",children:"Username"}),Object(d.jsx)("input",{type:"text",className:"form-control",id:"username",placeholder:"Username",required:!0,value:a,onChange:function(e){return c(e.target.value)}}),!P&&Object(d.jsx)("div",{className:"invalid-feedback",children:"This username is already taken."})]}),Object(d.jsxs)("div",{className:"form-group "+(v?"":"is-invalid"),children:[Object(d.jsx)("label",{htmlFor:"password",className:"required",children:"Password"}),Object(d.jsx)("input",{type:"password",className:"form-control",id:"password",placeholder:"Password",required:!0,value:l,onChange:function(e){return b(e.target.value)}}),!v&&Object(d.jsx)("div",{className:"invalid-feedback",children:Object(d.jsxs)("ul",{children:[Object(d.jsx)("li",{children:"Password must be at least 8 characters long"}),Object(d.jsx)("li",{children:"Contain at least one digit (0-9)"}),Object(d.jsx)("li",{children:"Contain at least one uppercase letter (A-Z)"})]})})]}),Object(d.jsxs)("div",{className:"form-group "+(S?"":"is-invalid"),children:[Object(d.jsx)("label",{htmlFor:"confirm-password",className:"required",children:"Confirm password"}),Object(d.jsx)("input",{type:"password",className:"form-control",id:"confirm-password",placeholder:"Confirm password",required:!0,value:O,onChange:function(e){return p(e.target.value)}}),!S&&Object(d.jsx)("div",{className:"invalid-feedback",children:"The passwords don't match."})]}),Object(d.jsx)("div",{className:"form-group",children:Object(d.jsx)("input",{className:"btn btn-primary btn-block",type:"submit",value:"Sign up"})}),Object(d.jsxs)("span",{className:"space-top",children:["Already have an account? ",Object(d.jsx)("a",{href:"/signin",children:"Sign in"})]})]})]})},M=function(e){var t=e.length>=8,n=null!==e.match(/[A-Z]/),a=null!==e.match(/\d/);return t&&n&&a},I=n(68),L=function(e){var t=o.a.useState(void 0),n=Object(u.a)(t,2),a=n[0],c=n[1],r=o.a.useState(void 0),i=Object(u.a)(r,2),l=i[0],b=i[1],j=o.a.useState(""),h=Object(u.a)(j,2),f=h[0],m=h[1],p=o.a.useState(0),x=Object(u.a)(p,2),v=x[0],y=x[1],A=Object(S.f)().id;return Object(s.useEffect)((function(){var e;(A?(e=A,g().then((function(t){return O.a.get("".concat(t,"/api/user/getbyid"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth"))},params:{id:e}})}))):g().then((function(e){return O.a.get("".concat(e,"/api/user/get"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth"))}})}))).then((function(e){var t=e.data;m(t.username),y(t.highscore),t.stats.length>0&&(c(T(t.stats.map((function(e){return e.score})),"#D11149")),b(T(t.stats.map((function(e){return e.bpm})),"#6610F2")))})).catch((function(e){return console.log(e)}))}),[A]),Object(d.jsx)("div",{className:"container-fluid",children:Object(d.jsxs)("div",{className:"row",children:[Object(d.jsx)("div",{className:"col-lg-3",children:Object(d.jsxs)("div",{className:"card",children:[Object(d.jsx)("h2",{className:"card-title",children:f}),Object(d.jsxs)("p",{children:["Highscore: ",v]})]})}),Object(d.jsxs)("div",{className:"col-lg-9",children:[Object(d.jsxs)("div",{className:"card",children:[Object(d.jsx)("h2",{className:"card-title",children:"Highscores"}),a&&Object(d.jsx)(I.a,{data:a,options:Y}),!a&&Object(d.jsx)("p",{children:"No highscores"})]}),Object(d.jsxs)("div",{className:"card",children:[Object(d.jsx)("h2",{className:"card-title",children:"Blocks per minute"}),l&&Object(d.jsx)(I.a,{data:a,options:Y}),!l&&Object(d.jsx)("p",{children:"No bpm data"})]})]})]})})},T=function(e,t){if(0!==e.length)return{labels:["-","-","-","-","-","-","-"],datasets:[{label:"Highscores",data:e,fill:!0,borderColor:t,tension:.1}]}},Y={plugins:{title:{display:!1},legend:{display:!1}}},q=function(e){return Object(d.jsxs)("div",{children:[e.authenticated&&e.children,!e.authenticated&&Object(d.jsx)(N,{onAuthenticated:e.onAuthenticated})]})},G=n(6);!function(e){e[e.EMPTY=0]="EMPTY",e[e.ORANGE=1]="ORANGE",e[e.GREEN=2]="GREEN",e[e.RED=3]="RED",e[e.YELLOW=4]="YELLOW",e[e.BLUE=5]="BLUE",e[e.CYAN=6]="CYAN",e[e.PURPLE=7]="PURPLE"}(a||(a={})),function(e){e[e.BLOCK=0]="BLOCK",e[e.BAR=1]="BAR",e[e.Z=2]="Z",e[e.L=3]="L",e[e.T=4]="T"}(c||(c={})),function(e){e[e.UP=0]="UP",e[e.RIGHT=1]="RIGHT",e[e.DOWN=2]="DOWN",e[e.LEFT=3]="LEFT"}(r||(r={}));var W=[{color:a.PURPLE,shape:c.T,rotation:r.UP,x:0,y:0},{color:a.CYAN,shape:c.BAR,rotation:r.UP,x:0,y:0},{color:a.BLUE,shape:c.L,rotation:r.UP,x:0,y:0},{color:a.ORANGE,shape:c.L,rotation:r.DOWN,x:0,y:0},{color:a.YELLOW,shape:c.BLOCK,rotation:r.UP,x:0,y:0},{color:a.RED,shape:c.Z,rotation:r.UP,x:0,y:0},{color:a.GREEN,shape:c.Z,rotation:r.DOWN,x:0,y:0}],F=function(e){var t=Math.floor(Math.random()*W.length);return Object(E.a)(Object(E.a)({},W[t]),{},{x:e})},Z=function(e,t,n,a){switch(n){case c.T:return function(e,t,n){switch(n){case r.UP:return[{x:e,y:t},{x:e+1,y:t},{x:e+2,y:t},{x:e+1,y:t+1}];case r.RIGHT:return[{x:e,y:t},{x:e,y:t+1},{x:e,y:t+2},{x:e+1,y:t+1}];case r.DOWN:return[{x:e,y:t+1},{x:e+1,y:t+1},{x:e+2,y:t+1},{x:e+1,y:t}];case r.LEFT:return[{x:e+1,y:t},{x:e+1,y:t+1},{x:e+1,y:t+2},{x:e,y:t+1}]}}(e,t,a);case c.L:return function(e,t,n){switch(n){case r.UP:return[{x:e,y:t},{x:e,y:t+1},{x:e+1,y:t+1},{x:e+2,y:t+1}];case r.RIGHT:return[{x:e,y:t},{x:e+1,y:t},{x:e,y:t+1},{x:e,y:t+2}];case r.DOWN:return[{x:e,y:t},{x:e+1,y:t},{x:e+2,y:t},{x:e+2,y:t+1}];case r.LEFT:return[{x:e+1,y:t},{x:e+1,y:t+1},{x:e+1,y:t+2},{x:e,y:t+2}]}}(e,t,a);case c.Z:return function(e,t,n){switch(n){case r.UP:return[{x:e+1,y:t},{x:e,y:t+1},{x:e+1,y:t+1},{x:e,y:t+2}];case r.RIGHT:return[{x:e+1,y:t},{x:e,y:t},{x:e+1,y:t+1},{x:e+2,y:t+1}];case r.DOWN:return[{x:e,y:t},{x:e,y:t+1},{x:e+1,y:t+1},{x:e+1,y:t+2}];case r.LEFT:return[{x:e+1,y:t},{x:e,y:t+1},{x:e+1,y:t+1},{x:e+2,y:t}]}}(e,t,a);case c.BAR:return function(e,t,n){switch(n){case r.UP:case r.DOWN:return[{x:e,y:t},{x:e+1,y:t},{x:e+2,y:t},{x:e+3,y:t}];case r.RIGHT:case r.LEFT:return[{x:e,y:t},{x:e,y:t+1},{x:e,y:t+2},{x:e,y:t+3}]}}(e,t,a);case c.BLOCK:return function(e,t,n){return[{x:e,y:t},{x:e,y:t+1},{x:e+1,y:t},{x:e+1,y:t+1}]}(e,t);default:return[]}},z=function(e,t){var n=Z(e.x,e.y,e.shape,e.rotation),a=t.map((function(e){return e.slice()}));return n.forEach((function(t){var n=t.x,c=t.y;try{a[c][n]=e.color}catch(r){console.log(r)}})),a},Q=function(e,t,n,c,r){var s=Z(e.x+n,e.y+c,e.shape,r||e.rotation),o=s.some((function(e){e.x;return e.y<0})),i=s.some((function(e){var t=e.x;e.y;return t<0})),l=s.some((function(e){var n=e.x;e.y;return n>t[0].length-1})),u=s.some((function(e){e.x;return e.y>t.length-1})),d=o||i||l||u;if(!d){var b=s.some((function(e){var n=e.x,c=e.y;return t[c][n]!==a.EMPTY}));return{outOfBounds:{top:o,left:i,right:l,bottom:u},collision:b=b||s.some((function(e){e.x;return e.y>=t.length})),combined:d||b}}return{outOfBounds:{top:o,left:i,right:l,bottom:u},collision:s.some((function(e){e.x;return e.y>=t.length})),combined:!0}},J=function(e){var t=Object(s.useRef)(null),n=e.field,c=e.blockSize,r=e.width,o=e.height,i=e.players;return Object(s.useEffect)((function(){var e=t.current;if(e){var r=e.getContext("2d");r&&function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#0d1a48";for(var t=0;t<n[0].length;t++)for(var r=0;r<n.length;r++)if(n[r][t]!==a.EMPTY){switch(e.strokeStyle="#0d1a48",e.lineWidth=3,n[r][t]){case a.ORANGE:e.fillStyle="#e56d23";break;case a.GREEN:e.fillStyle="#16cc40";break;case a.RED:e.fillStyle="#d23542";break;case a.YELLOW:e.fillStyle="#f7ca18";break;case a.BLUE:e.fillStyle="#4a68dd";break;case a.CYAN:e.fillStyle="#5cddd7";break;case a.PURPLE:e.fillStyle="#960ac3";break;default:e.fillStyle="#898989"}e.fillRect(t*c,r*c,c,c),e.strokeRect(t*c,r*c,c,c)}for(var s=0;s<i.length;s++){var o=i[s];o.block&&(e.fillStyle="#ffffff",e.font="11px Arial",e.fillText("".concat(o.username),o.block.x*c+10,o.block.y*c-c/2))}}(r)}return function(){window.cancelAnimationFrame(undefined)}}),[n,c,i]),Object(d.jsx)("canvas",{ref:t,width:r,height:o,className:"canvasContainer"})},K=function(e){var t=o.a.useState(e.field),n=Object(u.a)(t,2),a=n[0],c=n[1],r=Object(s.useRef)(),i=Object(s.useRef)(),l=Object(s.useRef)(Date.now()),b=e.field,j=e.player,m=e.players,O=e.onBlockFix,p=e.onPlayerMove,x=Object(s.useCallback)((function(){Q(j.block,b,0,1).combined||p(Object(E.a)(Object(E.a)({},j),{},{block:Object(E.a)(Object(E.a)({},j.block),{},{y:j.block.y+1})}))}),[j,b,p]);Object(s.useEffect)((function(){return r.current=setInterval(Object(f.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(Date.now()-l.current>1e3&&(x(),l.current=Date.now()),t=z(j.block,b),n=0;n<m.length;n++)m[n].block&&(t=z(m[n].block,t));c(t);case 4:case"end":return e.stop()}}),e)}))),20),function(){return clearInterval(r.current)}}),[j,b,m,x]),Object(s.useEffect)((function(){return Q(j.block,b,0,1).collision&&(clearTimeout(i.current),i.current=setTimeout((function(){O(z(j.block,b))}),500)),function(){return clearTimeout(i.current)}}),[j,b,O]);var g=Object(s.useCallback)((function(e){switch(e.key){case"ArrowDown":e.preventDefault(),Q(j.block,b,0,1).combined||p(Object(E.a)(Object(E.a)({},j),{},{block:Object(E.a)(Object(E.a)({},j.block),{},{y:j.block.y+1})}));break;case"ArrowLeft":e.preventDefault(),Q(j.block,b,-1,0).combined||p(Object(E.a)(Object(E.a)({},j),{},{block:Object(E.a)(Object(E.a)({},j.block),{},{x:j.block.x-1})}));break;case"ArrowRight":e.preventDefault(),Q(j.block,b,1,0).combined||p(Object(E.a)(Object(E.a)({},j),{},{block:Object(E.a)(Object(E.a)({},j.block),{},{x:j.block.x+1})}));break;case"ArrowUp":e.preventDefault();for(var t=(j.block.rotation+1)%4,n=!1,a=0,c=0,r=0;r<10;r++){var s=Q(j.block,b,c,a,t);if(!s.combined){n=!0;break}s.outOfBounds.bottom&&a--,s.outOfBounds.top&&a++,s.outOfBounds.left&&c++,s.outOfBounds.right&&c--}n&&p(Object(E.a)(Object(E.a)({},j),{},{block:Object(E.a)(Object(E.a)({},j.block),{},{x:j.block.x+c,y:j.block.y+a,rotation:t})}));break;case" ":for(var o=0;!Q(j.block,b,0,o).combined;)o++;p(Object(E.a)(Object(E.a)({},j),{},{block:Object(E.a)(Object(E.a)({},j.block),{},{y:j.block.y+(o-1)})}))}}),[b,j,p]);return Object(s.useEffect)((function(){return window.addEventListener("keydown",g),function(){window.removeEventListener("keydown",g)}}),[g]),Object(d.jsx)(J,{width:25*b[0].length,height:25*b.length,field:a,blockSize:25,players:[].concat(Object(G.a)(m),[j])})},V=n(117),X=n.n(V),H=function(e){var t=Object(s.useState)(""),n=Object(u.a)(t,2),a=n[0],c=n[1],r=function(){a.length>0&&(e.onMessage({id:e.userId,message:a}),c(""))};return Object(d.jsxs)("div",{className:"chat-container",children:[Object(d.jsx)("div",{className:"chat-message-container",children:e.messages.map((function(t,n){return Object(d.jsx)("div",{className:t.id===e.userId?"chat-right":"chat-left",children:Object(d.jsx)("div",{className:"chat-message",children:t.message})},n)}))}),Object(d.jsx)("form",{onSubmit:function(e){e.preventDefault(),r()},children:Object(d.jsxs)("div",{className:"input-group",children:[Object(d.jsx)("input",{type:"text",className:"form-control",placeholder:"Message...",value:a,onChange:function(e){return c(e.target.value)}}),Object(d.jsx)("div",{className:"input-group-append",children:Object(d.jsx)("button",{className:"btn btn-primary",type:"submit",onClick:r,children:"Send"})})]})})]})},_=function(e){var t=o.a.useState("players"),n=Object(u.a)(t,2),a=n[0],c=n[1];return Object(d.jsxs)("div",{className:"w-300 card",children:[Object(d.jsxs)("div",{className:"tab-header",children:[Object(d.jsx)("span",{className:"players"===a?"tab-item-selected":"tab-item",onClick:function(){return c("players")},children:"Players"}),Object(d.jsx)("span",{className:"chat"===a?"tab-item-selected":"tab-item",onClick:function(){return c("chat")},children:"Chat"})]}),"players"===a&&Object(d.jsx)("div",{children:e.players.map((function(e,t){return Object(d.jsxs)("div",{className:"player-item",children:[Object(d.jsx)("span",{children:e.username}),Object(d.jsx)("span",{className:e.ready?"player-item-ready":""})]},t)}))}),"chat"===a&&Object(d.jsx)(H,{messages:e.messages,userId:e.userId,onMessage:e.onMessage})]})},$=30,ee=20,te=localStorage.getItem("username")||"Jaqen H'ghar",ne=localStorage.getItem("userId")||"error_id"+Math.random(),ae=function(e){var t=Object(S.f)().room,n={id:ne,username:te,block:F(ce(0,$-3)),ready:!1},a=Object(s.useState)(n),c=Object(u.a)(a,2),r=c[0],o=c[1],i=Object(s.useState)([]),l=Object(u.a)(i,2),b=l[0],j=l[1],h=Object(s.useState)(re($,ee)),f=Object(u.a)(h,2),m=f[0],p=f[1],x=Object(s.useState)([]),y=Object(u.a)(x,2),A=y[0],N=y[1],w=Object(s.useState)(!1),E=Object(u.a)(w,2),k=E[0],P=E[1],U=Object(s.useState)(!1),D=Object(u.a)(U,2),B=D[0],M=D[1],I=Object(s.useState)(!1),L=Object(u.a)(I,2),T=L[0],Y=L[1],q=Object(s.useState)("Waiting for other players..."),W=Object(u.a)(q,2),Z=W[0],z=W[1],Q=Object(s.useState)(),J=Object(u.a)(Q,2),V=J[0],H=J[1],ae=Object(s.useState)(null),se=Object(u.a)(ae,2),oe=se[0],ie=se[1],le=Object(s.useRef)(0),ue=Object(s.useRef)(0);Object(s.useEffect)((function(){var e;(e=t,g().then((function(t){return O.a.get("".concat(t,"/api/sessions/get"),{params:{id:e}})}))).then((function(e){H({ip:e.data.ip,port:e.data.port})}))}),[t]),Object(s.useEffect)((function(){var e;return console.log("NEW SOCKET",V),V&&(e=X()("ws://".concat(V.ip,":").concat(V.port)),console.log("CONNECTED"),ie(e)),function(){e&&e.close()}}),[V]),Object(s.useEffect)((function(){oe&&(console.log("Joining room"),oe.emit("join",{room:t,username:te,id:ne}))}),[oe,t]),Object(s.useEffect)((function(){oe&&oe.on("connect",(function(){console.log("Connected to server"),0!==b.length&&(console.log("Sending players"),oe.emit("migrate",{room:t,field:m,players:b}))}))}),[oe,b,m,t]),Object(s.useEffect)((function(){oe&&(oe.on("disconnect",(function(){setTimeout((function(){V&&R(t,V.ip,V.port).then((function(){var e,n,a;console.log("DELETED"),(e=t,n=V,a="migrated lobby",g().then((function(t){return new Promise((function(c,r){v().then((function(s){C(s,n).then((function(n){console.log("MIG",{id:e,name:a,server:n}),O.a.post("".concat(t,"/api/sessions/migrate"),{id:e,name:a,server:n}).then((function(e){return c(e)})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}))}))}))).then((function(e){console.log("MIGRATE",e,e.data.server.ip,e.data.server.port),H({ip:e.data.server.ip,port:e.data.server.port})})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}),3e3*Math.random())})),oe.on("onJoin",(function(e){j(e)})),oe.on("onLeave",(function(e){j(e)})),oe.on("onPlayerUpdate",(function(e){j(e)})),oe.on("onFieldUpdate",(function(e){p(e)})),oe.on("onChatMessage",(function(e){console.log("Message received"),N((function(t){return[].concat(Object(G.a)(t),[e.message])}))})),oe.on("onPlayerReady",(function(e){j(e)})),oe.on("onGameStart",(function(e){M(!0),le.current=Date.now()})),oe.on("onGameOver",(function(e){z("Game over! Score: ".concat(e.score)),Y(!0),M(!1);var n,a=(Date.now()-le.current)/1e3/60,c={bpm:ue.current/a,score:e.score,time:Date.now()};n=c,g().then((function(e){return O.a.post("".concat(e,"/api/account/poststat"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth"))},data:{gamescore:n}})})),R(t,V.ip,V.port)})))}),[oe,t,V]);var de=function(){P(!0),oe.emit("playerReady",{room:t,id:ne})};return Object(d.jsxs)("div",{className:"gameContainer",children:[Object(d.jsx)(_,{messages:A,onMessage:function(e){console.log("message"),oe.emit("chatMessage",{room:t,msg:e})},userId:ne,players:b.map((function(e){return{username:e.username,id:e.id,ready:e.ready}}))}),B&&Object(d.jsx)(K,{field:m,player:r,players:b.filter((function(e){return e.id!==ne})),onPlayerMove:function(e){o(e),oe.emit("playerUpdate",{room:t,id:ne,block:e.block})},onBlockFix:function(e){p(e),o((function(e){return e.block=F(ce(0,$-4)),e})),ue.current++,oe.emit("fieldUpdate",{room:t,field:e})}}),!B&&Object(d.jsxs)("div",{className:"waiting-container",children:[Object(d.jsx)("p",{className:"waiting-text",children:Z}),!k&&Object(d.jsx)("button",{className:"btn btn-primary",onClick:de,children:"Ready"}),T&&Object(d.jsx)("a",{href:"/",children:Object(d.jsx)("button",{className:"btn btn-primary",onClick:de,children:"Continue"})})]})]})},ce=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},re=function(e,t){for(var n=new Array(ee),c=0;c<n.length;c++)n[c]=new Array($).fill(a.EMPTY);return n},se=function(e){var t=Object(s.useState)(""),n=Object(u.a)(t,2),a=n[0],c=n[1],r=Object(s.useState)([]),o=Object(u.a)(r,2),i=o[0],l=o[1];return Object(s.useEffect)((function(){a.length>0&&function(e){return g().then((function(t){return O.a.get("".concat(t,"/api/user/search"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth"))},params:{query:e}})}))}(a).then((function(e){l(e.data.users)})).catch((function(){l([])}))}),[a]),Object(d.jsxs)("div",{className:"container-sm",style:{padding:"2em"},children:[Object(d.jsx)("input",{type:"text",className:"form-control",placeholder:"Search...",value:a,onChange:function(e){return c(e.target.value)}}),Object(d.jsxs)("div",{className:"searchResultsContainer",children:[i.length<=0&&Object(d.jsx)("p",{className:"noResults",children:"No results found."}),i.map((function(e,t){return Object(d.jsx)(oe,{username:e.username,highscore:e.highscore,id:e.id},"search_result_".concat(t))}))]})]})},oe=function(e){return Object(d.jsx)("div",{className:"w-400 mw-full",children:Object(d.jsxs)("div",{className:"card",children:[Object(d.jsx)("h2",{className:"card-title",children:e.username}),Object(d.jsxs)("p",{children:["Highscore :"," ",Object(d.jsx)("span",{className:"badge badge-primary",children:e.highscore})]}),Object(d.jsx)("div",{className:"text-right",children:Object(d.jsx)("a",{href:"user/".concat(e.id),className:"btn btn-primary",children:"Profile"})})]})})};var ie=function(){var e=n(285);Object(s.useEffect)((function(){e.onDOMContentLoaded()}),[e]);var t=Object(s.useState)(!0),a=Object(u.a)(t,2),c=a[0],r=a[1];return Object(s.useEffect)((function(){g().then((function(e){return O.a.get("".concat(e,"/api/account/isAuthenticated"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth"))}})})).then((function(e){console.log(e),r("Success"===e.data.message)})).catch((function(){return r(!1)}))}),[]),Object(d.jsx)("div",{className:"App",children:Object(d.jsx)(b,{authenticated:c,buttonText:c?"Account":"Sign in",children:Object(d.jsx)(w.a,{children:Object(d.jsxs)(S.c,{children:[Object(d.jsx)(S.a,{path:"/signin",children:Object(d.jsx)(N,{onAuthenticated:function(){return r(!0)}})}),Object(d.jsx)(S.a,{path:"/signup",children:Object(d.jsx)(B,{onAuthenticated:function(){return r(!0)}})}),Object(d.jsxs)(q,{authenticated:c,onAuthenticated:function(){return r(!0)},children:[Object(d.jsx)(S.a,{path:"/account",component:L}),Object(d.jsx)(S.a,{path:"/user/:id",component:L}),Object(d.jsx)(S.a,{path:"/lobby/:room",component:ae}),Object(d.jsx)(S.a,{path:"/",component:U,exact:!0}),Object(d.jsx)(S.a,{path:"/search",component:se})]})]})})})})},le=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,288)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))};l.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)(ie,{})}),document.getElementById("root")),le()},69:function(e,t,n){}},[[287,1,2]]]);
//# sourceMappingURL=main.d695ac56.chunk.js.map